<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Math Adventure</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Space Math">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#4A5568">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸš€</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%234A5568'/><text y='0.9em' x='0.1em' font-size='80'>ðŸš€</text></svg>">
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Space%20Math%20Adventure%22,%22short_name%22:%22Space%20Math%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22theme_color%22:%22%234A5568%22,%22background_color%22:%22%231a202c%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' rx='100' fill='%234A5568'/><text y='0.9em' x='0.15em' font-size='400'>ðŸš€</text></svg>%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22}]}">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* â€¦ existing keyframes & classes â€¦ */
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Optional: persist data across sessions â€“ uncomment localStorage bits below when selfâ€‘hosting
        const loadPlayerData = () => {
            const savedName       = localStorage.getItem('spaceMathPlayerName');
            const savedHighScore  = localStorage.getItem('spaceMathHighScore');
            const savedTotal      = localStorage.getItem('spaceMathTotalPoints');
            return {
                name:       savedName || '',
                highScore:  parseInt(savedHighScore)  || 0,
                totalPoints:parseInt(savedTotal)      || 0
            };
        };
        const savePlayerData = (name, high, total) => {
            localStorage.setItem('spaceMathPlayerName',  name);
            localStorage.setItem('spaceMathHighScore',   high);
            localStorage.setItem('spaceMathTotalPoints', total);
        };

        const SpaceMathGame = () => {
            const [gameState, setGameState] = useState('menu');

            // pull any stored values (commentâ€‘out loadPlayerData() if you don't want persistence)
            const initialData = loadPlayerData();
            const [playerName, setPlayerName]   = useState(initialData.name);
            const [highScore,  setHighScore]    = useState(initialData.highScore);
            const [totalPoints,setTotalPoints]  = useState(initialData.totalPoints);

            /* â€¦ all the existing state hooks remain unchanged â€¦ */

            /* --------------------------------------------------
               Whenever we potentially update name / scores, ALSO
               call savePlayerData so the numbers survive reloads.
            ---------------------------------------------------*/
            useEffect(() => {
                if (playerName) {
                    savePlayerData(playerName, highScore, totalPoints);
                }
            }, [playerName, highScore, totalPoints]);

            /* ---------------- score bookkeeping ---------------*/
            const registerFinalScore = (finalScore) => {
                // highâ€‘score check
                if (finalScore > highScore) {
                    setHighScore(finalScore);
                }
                // add to running total
                if (finalScore > 0) {
                    setTotalPoints(tp => tp + finalScore);
                }
            };

            /* Replace previous scattered highâ€‘score logic with a
               single call to registerFinalScore() anywhere we end
               a run (game over OR victory)                        */

            /* Example â€“ inside handleAnswer() when lives hit 0: */
            // registerFinalScore(score);

            /* Example â€“ inside victory branch after computing score: */
            // registerFinalScore(score);

            /* You will need to swap the old direct highScore/ setHighScore
               updates for this helper wherever they appear.         */

            /* --------------------------------------------------*/

            /* ---------- UI: display running total -------------*/
            // 1. Menu screen â€“ below High Score
            //    <p className="text-white">Total Points: <span className="text-yellow-300 font-bold">{totalPoints}</span></p>

            // 2. Levelâ€‘select header (under High Score)
            //    | High Score: X | Total: Y

            // 3. Optional â€“ inâ€‘game HUD next to score if desired.

            /* --------------------------------------------------*/

            /*  All remaining original component code stays the
                same, except for the three integration spots:     
                a) call registerFinalScore(score) in gameâ€‘over
                   and victory flows
                b) show {totalPoints} in the menu / levelâ€‘select
                   screens.
                c) reset totalPoints to 0 when player switches.
            ---------------------------------------------------*/
        };

        ReactDOM.render(<SpaceMathGame />, document.getElementById('root'));
    </script>
</body>
</html>
